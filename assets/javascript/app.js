// Category Objects (Global)
var _globalView = {
	categoryName: 'Global View',
	correctAnswers: 0,
	incorrectAnswers: 0,
	unanswered: 0,
	categoryDetailsId: 'gv-category-details',
	categorySummaryId: 'gv-summary',
	questions: [
	{
		question: 'What sanguine nickname for black market diamonds reflects the wars they\'re said to fund?',
		choices: ['Blood Diamonds','White Diamonds','Air Diamonds','Cubic Zirconia'],
		correctAnswer: 'Blood Diamonds',
	},
	{
		question: 'What Southeast Asian nation gets buzzed by bumblebee bats, the world\'s smallest mammals?',
		choices: ['Vietnam','Thailand','Indonesia','Myanmar'],
		correctAnswer: 'Thailand',
	},
	{
		question: 'What city banned pigeon-food vendors at Nelson\'s Column as part of its war on bird droppings?',
		choices: ['San Francisco','Hong Kong','London','New York'],
		correctAnswer: 'London',
	},
	{
		question: 'What Middle Eastern nation bills its Ramon Crater as the largest natural crater in the world?',
		choices: ['Israel','Baghdad','Tehran','Jerusalem'],
		correctAnswer: 'Israel',
	},
	{
		question: 'What nation challenges trekkers to cross an unforgiving plateau called the Great Karroo?',
		choices: ['Egypt','Nepal','Tanzania','South Africa'],
		correctAnswer: 'South Africa',
	}],
};

var _soundAndScreen = {
	categoryName: 'Sound & Screen',
	correctAnswers: 0,
	incorrectAnswers: 0,
	unanswered: 0,
	categoryDetailsId: 'ss-category-details',
	categorySummaryId: 'ss-summary',
	questions: [
	{
		question: 'What homage to beachwear helped launch Sisqo\'s solo career?',
		choices: ['The Macarena','Enter the Dru','The Thong Song','Last Dragon'],
		correctAnswer: 'The Thong Song',
	},
	{
		question: 'What did Jason Robards call \"the land of the living dead\"?',
		choices: ['The Haight','Disneyland','Hollywood','New York City'],
		correctAnswer: 'Hollywood',
	},
	{
		question: 'What Sex and the City principal is a Liverpudlian?',
		choices: ['Kim Cattrall','Sarah Jessica Paker','Kristin Davis','Chris Noth'],
		correctAnswer: 'Kim Cattrall',
	},
	{
		question: 'What 1999 song introduced Eminem\'s Slim Shady persona?',
		choices: ['My Name Is','I\'m Shady','Role Model','Brain Damage'],
		correctAnswer: 'My Name Is',
	},
	{
		question: 'Who was the first Taiwanese director to cop an Oscar?',
		choices: ['Jackie Chan','Ang Lee','Ariel Lin','Jerry Yan'],
		correctAnswer: 'Ang Lee',
	}],
};

var _news = {
	categoryName: 'News',
	correctAnswers: 0,
	incorrectAnswers: 0,
	unanswered: 0,
	categoryDetailsId: 'nws-category-details',
	categorySummaryId: 'nws-summary',
	questions: [
	{
		question: 'What Long Islander got in hot water with Albion Prison authorities for dying her hair with purplr Kool-Aid?',
		choices: ['Dominique Strauss-Khan (Foxy Brown)','Lil Kim','Amy Fisher','Amy Winehouse'],
		correctAnswer: 'Amy Fisher',
	},
	{
		question: 'What name was given to the gathering of 750,000-plus women that marched on Washington to oppose gun violence, in 2000?',
		choices: ['Mom\'s Against Guns March','The Women Against Guns March','Females Against Guns March','The Million Mom March'],
		correctAnswer: 'The Million Mom March',
	},
	{
		question: 'What African leader donned a team jersey to celebrate when the Springboks beat New Zealand at the 1995 Rugby World Cup?',
		choices: ['Kofi Atta Annan','Julius Malema','Nelson Mandela','Desmond Tutu'],
		correctAnswer: 'Nelson Mandela',
	},
	{
		question: 'What convicted serial killer\'s remains were exhumed from a Massachusetts grave for forensic tests, on October 26, 2001?',
		choices: ['Jeffrey Dahmer','Trevor Hardy','Albert DeSalvo\'s','Ricardo Caputo'],
		correctAnswer: 'Albert DeSalvo\'s',
	},
	{
		question: 'What convicted serial killer\'s remains were exhumed from a Massachusetts grave for forensic tests, on October 26, 2001?',
		choices: ['Jeffrey Dahmer','Trevor Hardy','Albert DeSalvo\'s','Ricardo Caputo'],
		correctAnswer: 'Albert DeSalvo\'s',
	},
	{
		question: 'Who sued Abe Hirschfeld for not coughing up the $1 million he promised for her dropping a lawsuit against Bill Clinton?',
		choices: ['Paula Jones','Monica Lewinsky','Nancy Kerrigan','Linda Tripp'],
		correctAnswer: 'Paula Jones',
	}],
};

var _writtenWord = {
	categoryName: 'The Written Word',
	correctAnswers: 0,
	incorrectAnswers: 0,
	unanswered: 0,
	categoryDetailsId: 'ww-category-details',
	categorySummaryId: 'ww-summary',
	questions: [
	{
		question: 'Who\'s the triangle-haired engineer that doesn\'t take criticism well, in Dilbert?',
		choices: ['Dilbert','Wally','Asok','Alice'],
		correctAnswer: 'Alice',
	},
	{
		question: 'Who topped the first-ever Forbes list of \"Richest Deceased Celebrities\" in 2001?',
		choices: ['Frank Sinatra','Elvis Presley','Jerry Garcia','John Lennon'],
		correctAnswer: 'Elvis Presley',
	},
	{
		question: 'What thighmistress squeezed out the diet guide Eat, Cheat and Melt the Fat Away?',
		choices: ['Carmen Electra','Cindy Crawford','Suzanne Somers','Martha Steward'],
		correctAnswer: 'Suzanne Sommers',
	},
	{
		question: 'What annual sporting event is central to Tom Clancy\'s book The Sum of All Fears?',
		choices: ['The Rose Bowl','The NBA Finals','The World Series','The Super Bowl'],
		correctAnswer: 'The Super Bowl',
	},
	{
		question: 'What\'s the last name of George MacDonald Fraser\'s brilliant old-school adventurer?',
		choices: ['Flashman','Bunyan','Sawyer','Dundee'],
		correctAnswer: 'Flashman',
	}],
};

var _innovations = {
	categoryName: 'Innovations',
	correctAnswers: 0,
	incorrectAnswers: 0,
	unanswered: 0,
	categoryDetailsId: 'inv-category-details',
	categorySummaryId: 'inv-summary',
	questions: [
	{
		question: 'What game console sold over 30 million units, dominating rivals like Intellivision and Colecovision, in the 11 years it was made?',
		choices: ['The Nintendo Entertainment System','The Sega Master System','The Commodore 64','The Atari VCS, or 2600'],
		correctAnswer: 'The Atari VCS, or 2600',
	},
	{
		question: 'What virus, slated to have its last samples destroyed simultaneously in Atlanta and Moscow, got a reprieve on December 31, 1993?',
		choices: ['Polio','Ebola','Smallpox','Rabies'],
		correctAnswer: 'Smallpox',
	},
	{
		question: 'What remedy for erectile dysfunction, made with 18 herbs, was unleashed in America in 2000 after 50 years as a hot item in China?',
		choices: ['betterMAN','Tiger Balm','Dragon Herbs','Dong Quai'],
		correctAnswer: 'betterMAN',
	},
	{
		question: 'What unusual phenomenon knocked out power to six million North Americans in 1989?',
		choices: ['a water-spout','a solar storm','ball lighting','a meteor strike'],
		correctAnswer: 'a solar storm',
	},
	{
		question: 'What nation enjoyed the world\'s highest percentage of homes with personal computers, byt 2001?',
		choices: ['USA','South Korea','Britain','Iceland'],
		correctAnswer: 'South Korea',
	}],
};

var _gameTime = {
	categoryName: 'Game Time',
	correctAnswers: 0,
	incorrectAnswers: 0,
	unanswered: 0,
	categoryDetailsId: 'gt-category-details',
	categorySummaryId: 'gt-summary',
	questions: [
	{
		question: 'How many bulls bite the dust annually in Spanish bull rings?',
		choices: ['11,000','33,000','55,000','77,000'],
		correctAnswer: '11,000',
	},
	{
		question: 'What hip-hop group\'s first kung fu video game racket up 600,000 sales for Playstation?',
		choices: ['Run DMC\'s','Wu Tang Clan\'s','N.W.A\'s','Beastie Boys\''],
		correctAnswer: 'Wu Tang Clan\'s',
	},
	{
		question: 'How many homers did Mark McGwire blast in his final 11 at-bats, the year he hit 70?',
		choices: ['One','Three','Five','Seven'],
		correctAnswer: 'Five',
	},
	{
		question: 'What sport, otherwise banned on Japanese ski slopes, debuted at the 1998 Nagano Olympics?',
		choices: ['Snowmobiling','Sledding','Ski Jumping','Snowboarding'],
		correctAnswer: 'Snowboarding',
	},
	{
		question: 'Who interrupted his retirement to play in the 1992 NBA All-Star Game, then was named MVP?',
		choices: ['Magic Johnson','Michael Jordan','Larry Bird','Karl Malone'],
		correctAnswer: 'Magic Johnson',
	}],
};

var counter = {
	images: [
		'./assets/images/counter-0.png',
		'./assets/images/counter-1.png',
		'./assets/images/counter-2.png',
		'./assets/images/counter-3.png',
		'./assets/images/counter-4.png',
		'./assets/images/counter-5.png',
		'./assets/images/counter-6.png',
		'./assets/images/counter-7.png',
		'./assets/images/counter-8.png',
		'./assets/images/counter-9.png',
		'./assets/images/counter-10.png',
		'./assets/images/counter-11.png',
		'./assets/images/counter-12.png',
		'./assets/images/counter-13.png',
		'./assets/images/counter-14.png',
		'./assets/images/counter-15.png',
		'./assets/images/counter-16.png',
		'./assets/images/counter-17.png',
		'./assets/images/counter-18.png',
		'./assets/images/counter-19.png',
		'./assets/images/counter-20.png',
		'./assets/images/counter-21.png',
		'./assets/images/counter-22.png',
		'./assets/images/counter-23.png',
		'./assets/images/counter-24.png',
		'./assets/images/counter-25.png',
		'./assets/images/counter-26.png',
		'./assets/images/counter-27.png',
		'./assets/images/counter-28.png',
		'./assets/images/counter-29.png',
		'./assets/images/counter-30.png',
		'./assets/images/counter-time-out.png'
	],
};
// Category Objects (Global)

// Global variables
var _secondsRemaining = 30;
var _intervalId = 0;
var _currentCategoryObj = null;
var _currentQuestionIndex = null;
var _currentCategoryStartButton = null;
var _arrayOfObjects = [_globalView, _soundAndScreen, _news, _writtenWord, _innovations, _gameTime];
var _completedCategoryStartButtons = [];
var _questionsAlreadyDisplayed = [];
// End Global variables

// Listeners

$(document).on('click', '.category', displayCategory);

$(document).on('click', '.choice', checkAnswer);

$(document).on('click', '.category-start-btn', startCategory);

$(document).on('click', '.summary-button', gameRestartOrContinue)
// End Listeners

// Test function for debug only
/*
function testFunction() {
	$('#qa-container').css('display', 'block');
	//$('#qa-container').animate({left:'-1000px', top:'0px'}, 'slow');
	$('#qa-container').animate({left:'0px', top:'0px'}, 'slow');
}
*/

function startCategory() {
	// Slide up all category menu items
	$('.category-details').slideUp('slow');

	var category = $(this).attr('data-name');

	switch(category) {
		case 'global-view':
			_currentCategoryObj = _globalView;
			break;
		case 'written-word':
			_currentCategoryObj = _writtenWord;
			break;
		case 'sound-and-screen':
			_currentCategoryObj = _soundAndScreen;
			break;
		case 'innovations':
			_currentCategoryObj = _innovations;
			break;
		case 'news':
			_currentCategoryObj = _news;
			break;
		case 'game-time':
			_currentCategoryObj = _gameTime;
			break;
	}

	disableCategoryStartButtons(true);
	
	toggleQandAContainer(true);

	nextQuestion();

	// Store the start button object, this will be used at a later point
	_currentCategoryStartButton = this;
}

// Displays the question and answer container
function toggleQandAContainer(show) {
	if(show) {
		$('#qa-container').css('display', 'block');
		$('#qa-container').animate({left:'0px', top:'0px'}, 'slow');
	} else {
		$('#qa-container').css('display', 'none');
	}
}

// Displays the details for the selected cateogory.  Will toggle up all others.
function displayCategory() {
	$('.category-details').slideUp('slow');
	$('.category').css('border', '0');

	$(this).css('border', '1px solid black');
	$('#' + this.id + '-details').slideToggle('slow');
}

// Displays category completion summary, if all questions in a category have been displayed.
// Or, it will display the next question in a category.
function nextQuestion() {
	if(isCategoryComplete()) {
		// Stop the countdown
		clearInterval(_intervalId);

		// Display category complete summary
		clearGameArena();

		displayCategoryCompleteSummary();

		// Save the start button for this category
		_completedCategoryStartButtons.push(_currentCategoryStartButton);
	} else {
		displayRandomQuestionFromCategory();

		startCountdown();
	}
}

// Displays a random question from the specified category
function displayRandomQuestionFromCategory() {
	// Clear previous question
	$('#question-text').empty();
	$('#question-text').css('opacity', '0');

	$('.choice-text').empty();
	$('.choice-text').css('opacity', '0');

	// Select a random position
	var randomPos = Math.floor(Math.random() * _currentCategoryObj.questions.length);

	// We want to avoid displaying a question twice
	if(_questionsAlreadyDisplayed.length == 0) {
		_currentQuestionIndex = randomPos;
	} else {
		while(_questionsAlreadyDisplayed.includes(randomPos)) {
			// Keep randomly selecting until an index for a question that
			// has not been displayed yet is encountered.
			randomPos = Math.floor(Math.random() * _currentCategoryObj.questions.length);
		}

		// Execution should reach here once a random position not already used has been found
		_currentQuestionIndex = randomPos;
	}

	_questionsAlreadyDisplayed.push(_currentQuestionIndex);
	
	// Get the question
	var questionObj = _currentCategoryObj.questions[randomPos];

	// Display question
	var question = $('<p></p>');
	question.text(questionObj.question);

	$('#question-text').html(question);
	$('#question-text').animate({opacity: '0.1'}, 'slow');
	$('#question-text').animate({opacity: '0.3'}, 'slow');
	$('#question-text').animate({opacity: '0.5'}, 'slow');
	$('#question-text').animate({opacity: '0.8'}, 'slow');
	$('#question-text').animate({opacity: '1.0'}, 'slow');


	// Display choices
	for(var i=0; i<questionObj.choices.length; i++) {
		var choice = $('<p></p>');
		choice.attr('choice-value', questionObj.choices[i]);
		choice.text(questionObj.choices[i]);

		// Get the choice-* id using the i value
		$('#choice-' + i).html(choice);
		$('#choice-' + i).animate({opacity: '0.1'}, 'slow');
		$('#choice-' + i).animate({opacity: '0.3'}, 'slow');
		$('#choice-' + i).animate({opacity: '0.5'}, 'slow');
		$('#choice-' + i).animate({opacity: '0.8'}, 'slow');
		$('#choice-' + i).animate({opacity: '1.0'}, 'slow');
	}
}

// Checks the user selection for correctness
function checkAnswer() {
	var userChoice = $(this).attr('choice-value');

	var correctAnswer = _currentCategoryObj.questions[_currentQuestionIndex].correctAnswer;

	if(userChoice === correctAnswer) {
		_currentCategoryObj.correctAnswers++;

		$('#result').html('Correct!');
	} else {
		_currentCategoryObj.incorrectAnswers++;

		$('#result').html('Wrong!');
	}

	// Display a new question
	nextQuestion();
}

// Starts the timer countdown
function startCountdown() {
	_secondsRemaining = 2;

	clearInterval(_intervalId);

	setCounterImage(false);

	_intervalId = setInterval(countdown, 1000);
}

// Keeps the timer countdown going
function countdown() {
	_secondsRemaining--;

	setCounterImage(false);

	if(_secondsRemaining < 0) {
		setCounterImage(true);

		clearInterval(_intervalId);

		// Update unanswered total and display an new question
		_currentCategoryObj.unanswered++;

		$('#result').html('Time\'s Up Slick!');

		nextQuestion();
	}
}

function setCounterImage(isTimeOut) {
	var counterImage = $('<img/>');
	counterImage.addClass('countdown-img');

	if(isTimeOut) {
		counterImage.attr('src', counter.images[31]);
		$('#countdown-container').html(counterImage);
	} else {
		counterImage.attr('src', counter.images[_secondsRemaining]);
		$('#countdown-container').html(counterImage);
	}
}

// Checks if all questions for the category have been attempted
function isCategoryComplete() {
	var totalQuestions = _currentCategoryObj.questions.length;

	var totalAttemptedSoFar = _currentCategoryObj.correctAnswers + _currentCategoryObj.incorrectAnswers + _currentCategoryObj.unanswered;

	if(totalQuestions === totalAttemptedSoFar) {
		return true;
	}

	return false;
}

// Display summary of the current category on the game arena
// Summary will also be displayed in the category menu
function displayCategoryCompleteSummary() {

	var header = $('<h2></h2>');
	header.text('Category Completed!');
	$('#category-summary').append(header);

	var categoryName = $('<p></p>');
	categoryName.text('Category Name:  ' + _currentCategoryObj.categoryName);
	$('#category-summary').append(categoryName);

	$('#category-summary').append('<p>Total Correct:  ' + _currentCategoryObj.correctAnswers + '</p>');
	$('#' + _currentCategoryObj.categorySummaryId).append('<p>Total Correct:  ' + _currentCategoryObj.correctAnswers + '</p>');
	
	$('#category-summary').append('<p>Total Incorrect:  ' + _currentCategoryObj.incorrectAnswers + '</p>');
	$('#' + _currentCategoryObj.categorySummaryId).append('<p>Total Incorrect:  ' + _currentCategoryObj.incorrectAnswers + '</p>');
	
	$('#category-summary').append('<p>Total Unanswered:  ' + _currentCategoryObj.unanswered + '</p>');
	$('#' + _currentCategoryObj.categorySummaryId).append('<p>Total Unanswered:  ' + _currentCategoryObj.unanswered + '</p>');

	var restartButton = $('<button></button>');
	restartButton.text('Start Over');
	restartButton.addClass('btn btn-primary btn-md summary-button');
	restartButton.attr('data-name', 'restart');
	$('#category-summary').append(restartButton);

	var categoryButton = $('<button></button>');
	categoryButton.text('Select Another Category');
	categoryButton.addClass('btn btn-primary btn-md summary-button');
	categoryButton.attr('data-name', 'category')
	$('#category-summary').append(categoryButton);
}

// Resets game
function restartGame() {
	// Reset totals in each object and any summary details in the category menu
	for(var i=0; i<_arrayOfObjects.length; i++) {
		var currentObj = _arrayOfObjects[i];

		currentObj.correctAnswers = 0;
		currentObj.incorrectAnswers = 0;
		currentObj.unanswered = 0;

		$('#' + currentObj.categorySummaryId).empty();
	}

	clearGameArena();

	// Reset all global variables
	_secondsRemaining = 30;
	_intervalId = 0;
	_currentCategoryObj = null;
	_currentQuestionIndex = null;
	_currentCategoryStartButton = null;
	_completedCategoryStartButtons = [];
	_questionsAlreadyDisplayed = [];

	disableCategoryStartButtons(false);
}

// Setups game so user can continue
function continueGame() {
	clearGameArena();
		
	// Reset global variables
	_secondsRemaining = 30;
	_intervalId = 0;
	_currentCategoryObj = null;
	_currentQuestionIndex = null;
	_currentCategoryStartButton = null;
	//_completedCategoryStartButtons = [];
	_questionsAlreadyDisplayed = [];

	disableCategoryStartButtons(false);
}

// Clear the contents of the game arena
function clearGameArena() {
	$('#category-summary').empty();
	$('#qa-container').css('display', 'none');
	$('#qa-container').css('left', '-1000px');
}

// Enables or disables the category start buttons
// The completedStartButtons array is checked and 
// if is it not empty, those buttons will be disabled
function disableCategoryStartButtons(disableValue) {
	$('.category-start-btn').prop('disabled', disableValue);

	for(var i=0; i<_completedCategoryStartButtons.length; i++) {
		$(_completedCategoryStartButtons[i]).prop('disabled', true);
	}
}

// Determines if game should restart or continue to allow user to select
// a new category
function gameRestartOrContinue() {
	var choice = $(this).attr('data-name');

	if(choice === 'restart') {
		restartGame();
	} else if(choice === 'category') {
		continueGame();
	} else {
		alert('Unhandled choice encountered while trying to determine game restart!\n' + choice);
	}
}